<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:EasySave.GUI.ViewModels"
        xmlns:conv="clr-namespace:EasySave.GUI.Converters;assembly=EasySave.GUI"
        x:Class="EasySave.GUI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding LanguageHelperInstance.MainWindowTitle}" 
        Width="1000" Height="650"
        Background="#F3F4F6">

  <!-- Ressources non visuelles -->
  <Window.Resources>
    <!-- Convertisseur pour afficher l'ordinal -->
    <conv:JobOrdinalConverter x:Key="JobOrdinalConverter"/>
    <!-- Convertisseur pour la couleur de fond des ToggleButtons selon IsChecked -->
    <conv:BoolToJobBackgroundConverter x:Key="BoolToJobBackgroundConverter"/>
  </Window.Resources>

  <!-- Styles dédiés -->
  <Window.Styles>
    <!-- Style pour les boutons de la barre latérale -->
    <Style Selector="Button.sidebar">
      <Setter Property="FontSize" Value="16"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Padding" Value="12"/>
      <Setter Property="Margin" Value="10,5"/>
      <Setter Property="Background" Value="#34495E"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Height" Value="50"/>
      <Setter Property="Width" Value="180"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
    </Style>

    <!-- Style pour les ToggleButtons représentant les jobs -->
    <Style Selector="ToggleButton.job">
      <Setter Property="BorderBrush" Value="#FF005A9E"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="4"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="Padding" Value="10,5"/>
      <Setter Property="Margin" Value="5"/>
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
  </Window.Styles>

  <Grid>
    <DockPanel>
      <!-- Barre latérale : un DockPanel permet de placer des éléments en haut et en bas -->
      <DockPanel DockPanel.Dock="Left" Background="#2C3E50" Width="220" Margin="10">
        <!-- Partie supérieure : logo d'application et boutons de navigation -->
        <StackPanel DockPanel.Dock="Top">
          <!-- Logo d'application agrandi -->
          <Image Source="avares://EasySave.GUI/Assets/logo.jpeg" Width="300" Height="100" Margin="10"/>
          <!-- Boutons de la barre latérale -->
          <Button Content="{Binding LanguageHelperInstance.ButtonAdd}" 
                  Command="{Binding OpenAddJobWindowCommand}"
                  Classes="sidebar"/>
          <Button Content="{Binding LanguageHelperInstance.ButtonModify}" 
                  Command="{Binding OpenModifyJobWindowCommand}"
                  Classes="sidebar"/>
          <Button Content="{Binding LanguageHelperInstance.ButtonList}" 
                  Command="{Binding OpenListAllJobWindowCommand}"
                  Classes="sidebar"/>
          <Button Content="{Binding LanguageHelperInstance.ButtonDelete}" 
                  Command="{Binding DeleteJobCommand}"
                  Classes="sidebar"/>
          <Button Content="{Binding LanguageHelperInstance.ButtonExecute}" 
                  Command="{Binding ExecuteAllJobsCommand}"
                  Classes="sidebar"/>
        </StackPanel>
        <!-- Logo de l'école en bas -->
        <Image Source="avares://EasySave.GUI/Assets/school_logo.png" 
               DockPanel.Dock="Bottom"
               HorizontalAlignment="Center" 
               Margin="10" 
               Width="200" Height="100"/>
      </DockPanel>

      <!-- Contenu principal -->
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>  <!-- Barre de menu -->
          <RowDefinition Height="*"/>     <!-- Liste des jobs -->
          <RowDefinition Height="Auto"/>  <!-- Statut en temps réel -->
        </Grid.RowDefinitions>

        <!-- Barre de menu -->
        <Menu Grid.Row="0" Background="White">
          <MenuItem Header="{Binding LanguageHelperInstance.FileMenuHeader}">
            <MenuItem Header="{Binding LanguageHelperInstance.MenuItemConfiguration}" 
                      Command="{Binding OpenConfigurationCommand}">
              <MenuItem.Icon>
                <Image Source="avares://EasySave.GUI/Assets/icon-config.png" Width="16" Height="16"/>
              </MenuItem.Icon>
            </MenuItem>
            <MenuItem Header="{Binding LanguageHelperInstance.MenuItemLanguage}">
              <MenuItem.Icon>
                <Image Source="avares://EasySave.GUI/Assets/icon-language.png" Width="16" Height="16"/>
              </MenuItem.Icon>
              <MenuItem Header="🇫🇷 {Binding French}" 
                        Command="{Binding ChangeLanguageCommand}" 
                        CommandParameter="fr"/>
              <MenuItem Header="🏴 {Binding English}" 
                        Command="{Binding ChangeLanguageCommand}" 
                        CommandParameter="en"/>
            </MenuItem>
            <MenuItem Header="{Binding LanguageHelperInstance.MenuItemExit}" 
                      Command="{Binding ExitCommand}">
              <MenuItem.Icon>
                <Image Source="avares://EasySave.GUI/Assets/icon-exit.png" Width="16" Height="16"/>
              </MenuItem.Icon>
            </MenuItem>
          </MenuItem>
        </Menu>

        <!-- Liste des jobs sous forme de ToggleButtons cliquables -->
        <ScrollViewer Grid.Row="1" Margin="20">
          <ItemsControl ItemsSource="{Binding BackupJobs}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <!-- Utilisation de ToggleButton pour la sélection.
                     La propriété Background est liée à IsChecked via le convertisseur. -->
                <ToggleButton Classes="job"
                              Background="{Binding IsChecked, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource BoolToJobBackgroundConverter}}">
                  <ToggleButton.Content>
                    <StackPanel Orientation="Vertical">
                      <TextBlock Text="{Binding Ordinal, Converter={StaticResource JobOrdinalConverter}}"
                                 FontSize="14" FontWeight="Bold"/>
                      <TextBlock Text="{Binding Name}" Margin="0,2,0,0"/>
                      <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Type: " FontSize="10" Foreground="LightGray"/>
                        <TextBlock Text="{Binding BackupType}" FontSize="10" Foreground="LightGray"/>
                      </StackPanel>
                    </StackPanel>
                  </ToggleButton.Content>
                  <!-- Effets visuels pour hover et pressed -->
                  <ToggleButton.Styles>
                    <Style Selector="ToggleButton:hover">
                      <Setter Property="Background" Value="#FF005A9E"/>
                    </Style>
                    <Style Selector="ToggleButton:pressed">
                      <Setter Property="Background" Value="#FF003D73"/>
                    </Style>
                  </ToggleButton.Styles>
                </ToggleButton>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>

        <!-- Statut en temps réel -->
        <Border Grid.Row="2" Background="White" BorderBrush="Gray" BorderThickness="1" Padding="10" Margin="20">
          <StackPanel>
            <TextBlock Text="{Binding LanguageHelperInstance.RealTimeStatusHeader}" 
                       FontWeight="Bold" FontSize="14" Foreground="Black"/>
            <TextBlock Text="{Binding RealTimeStatus}" FontSize="12" Foreground="Gray"/>
          </StackPanel>
        </Border>
      </Grid>
    </DockPanel>
  </Grid>
</Window>
